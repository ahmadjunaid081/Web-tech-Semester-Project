<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Management Dashboard</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        :root {
            --bs-primary-rgb: 13, 110, 253;
            --bs-primary: #0d6efd;
        }

        body {
            background-color: #f0f2f5;
        }

        .app-header {
            background-color: #fff;
            color: #212529;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.10);
        }

        .card-header {
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .loading-state,
        .empty-state {
            text-align: center;
            padding: 50px 0;
            color: #6c757d;
        }

        .modal-header {
            background-color: var(--bs-primary);
            color: white;
        }

        .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
</head>

<body>

    
    <header class="app-header sticky-top p-3 mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-journal-richtext me-2"></i>Article Dashboard</h4>
            <span class="text-muted">Powered by jQuery & JSONPlaceholder</span>
        </div>
    </header>

    
    <main class="container">
       
        <div class="card mb-4">
            <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-center">
                <div class="input-group mb-3 mb-md-0 me-md-3">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="search" id="search-input" class="form-control"
                        placeholder="Filter articles by title or content...">
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#postModal" id="add-post-btn">
                    <i class="bi bi-plus-lg me-1"></i> Add New Article
                </button>
            </div>
        </div>

        <div id="loading-state" class="loading-state">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Fetching articles...</p>
        </div>
        <div id="empty-state" class="empty-state d-none">
            <i class="bi bi-x-circle" style="font-size: 3rem;"></i>
            <p class="mt-2">No articles found. Try adjusting your search or adding a new article.</p>
        </div>

        <div id="posts-container" class="row g-4">
        </div>
    </main>

    <div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="postModalLabel">Add New Article</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="post-form">
                    <div class="modal-body">
                        <input type="hidden" id="post-id">
                        <div class="mb-3">
                            <label for="post-title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="post-title" required>
                        </div>
                        <div class="mb-3">
                            <label for="post-body" class="form-label">Content</label>
                            <textarea class="form-control" id="post-body" rows="8" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="save-post-btn">Save Article</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this article? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete Article</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notification-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i id="toast-icon" class="bi me-2"></i>
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-body"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            const API_URL = 'https://jsonplaceholder.typicode.com/posts';
            const postModal = new bootstrap.Modal(document.getElementById('postModal'));
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            const notificationToast = new bootstrap.Toast(document.getElementById('notification-toast'));

            function showLoading(isLoading) {
                $('#loading-state').toggleClass('d-none', !isLoading);
                $('#posts-container').toggleClass('d-none', isLoading);
            }

            function showNotification(message, isError = false) {
                const toastTitle = $('#toast-title');
                const toastBody = $('#toast-body');
                const toastHeader = $('.toast-header');
                const toastIcon = $('#toast-icon');

                toastTitle.text(isError ? 'Error' : 'Success');
                toastBody.text(message);

                toastHeader.removeClass('bg-danger bg-success text-white');
                toastIcon.removeClass('bi-check-circle-fill bi-exclamation-triangle-fill');

                if (isError) {
                    toastHeader.addClass('bg-danger text-white');
                    toastIcon.addClass('bi-exclamation-triangle-fill');
                } else {
                    toastHeader.addClass('bg-success text-white');
                    toastIcon.addClass('bi-check-circle-fill');
                }
                notificationToast.show();
            }

            function renderPosts(posts) {
                const postsContainer = $('#posts-container');
                postsContainer.empty();
                $('#empty-state').addClass('d-none');

                if (posts.length === 0) {
                    $('#empty-state').removeClass('d-none');
                    return;
                }

                posts.forEach(post => {
                    const postCard = `
                        <div class="col-12 col-md-6 col-lg-4 post-card" data-post-id="${post.id}">
                            <div class="card h-100">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span class="fw-bold">Article #${post.id}</span>
                                    <small class="text-muted">User ID: ${post.userId}</small>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title post-title">${post.title}</h5>
                                    <p class="card-text post-body">${post.body}</p>
                                </div>
                                <div class="card-footer bg-white border-top-0 text-end">
                                    <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${post.id}"><i class="bi bi-pencil-fill me-1"></i> Edit</button>
                                    <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${post.id}"><i class="bi bi-trash-fill me-1"></i> Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    postsContainer.append(postCard);
                });
            }

            let allPosts = []; 
            function fetchPosts() {
                showLoading(true);
                $.get(API_URL)
                    .done(function (posts) {
                        allPosts = posts.slice(0, 15);
                        renderPosts(allPosts);
                    })
                    .fail(function () {
                        showNotification('Failed to fetch articles.', true);
                        $('#empty-state').removeClass('d-none');
                    })
                    .always(function () {
                        showLoading(false);
                    });
            }

            $('#search-input').on('keyup', function () {
                const searchTerm = $(this).val().toLowerCase();
                const filteredPosts = allPosts.filter(post =>
                    post.title.toLowerCase().includes(searchTerm) ||
                    post.body.toLowerCase().includes(searchTerm)
                );
                renderPosts(filteredPosts);
            });

            $('#add-post-btn').on('click', function () {
                $('#post-form')[0].reset();
                $('#post-id').val('');
                $('#postModalLabel').text('Add New Article');
                $('#save-post-btn').text('Create Article');
            });

            $('body').on('click', '.edit-btn', function () {
                const postId = $(this).data('id');
                const post = allPosts.find(p => p.id === postId);
                if (post) {
                    $('#post-id').val(post.id);
                    $('#post-title').val(post.title);
                    $('#post-body').val(post.body);
                    $('#postModalLabel').text(`Edit Article #${post.id}`);
                    $('#save-post-btn').text('Save Changes');
                    postModal.show();
                } else {
                    showNotification('Article not found.', true);
                }
            });

            $('#post-form').on('submit', function (e) {
                e.preventDefault();
                const postId = $('#post-id').val();
                const postData = {
                    title: $('#post-title').val(),
                    body: $('#post-body').val(),
                    userId: 1
                };

                const isUpdate = postId !== '';
                const url = isUpdate ? `${API_URL}/${postId}` : API_URL;
                const method = isUpdate ? 'PUT' : 'POST';

                $.ajax({
                    url: url,
                    method: method,
                    contentType: 'application/json',
                    data: JSON.stringify(postData),
                    success: function (response) {
                        postModal.hide();
                        showNotification(`Article successfully ${isUpdate ? 'updated' : 'created'}!`);

                        if (isUpdate) {
                            // Find and update the post in the cache and re-render
                            const index = allPosts.findIndex(p => p.id == postId);
                            if (index !== -1) {
                                allPosts[index] = response;
                            }
                        } else {
                            // Add new post to the cache (JSONPlaceholder returns a predictable ID)
                            allPosts.unshift(response);
                        }
                        renderPosts(allPosts);
                    },
                    error: function () {
                        showNotification(`Failed to ${isUpdate ? 'update' : 'create'} article.`, true);
                    }
                });
            });

            $('body').on('click', '.delete-btn', function () {
                const postId = $(this).data('id');
                $('#confirm-delete-btn').data('id', postId); // Store ID on confirm button
                deleteModal.show();
            });

            $('#confirm-delete-btn').on('click', function () {
                const postId = $(this).data('id');
                deleteModal.hide();
                $.ajax({
                    url: `${API_URL}/${postId}`,
                    method: 'DELETE',
                    success: function () {
                        showNotification(`Article #${postId} deleted successfully.`);
                        // Remove from cache and re-render
                        allPosts = allPosts.filter(p => p.id !== postId);
                        renderPosts(allPosts);
                    },
                    error: function () {
                        showNotification(`Failed to delete Article #${postId}.`, true);
                    }
                });
            });

            fetchPosts();
        });
    </script>
</body>

</html>